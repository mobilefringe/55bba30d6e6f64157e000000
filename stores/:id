<!-- Mapplic Dependency -->
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery-mousewheel/3.1.13/jquery.mousewheel.min.js"></script>
<script src="//codecloud.cdn.speedyrails.net/sites/5a9eeaa46e6f6405fb150000/text/javascript/1520365246170/mapplic_mmsdk.js"></script>
<script src="//codecloud.cdn.speedyrails.net/sites/59bac7db6e6f644f22ba0000/text/javascript/1484859750000/hammer.min.js"></script>

<div class="green_bar"></div>
<div class="page_main_container">
    <div class="page_left">
        <div id="store_container">
            <script id="store_template" type="x-tmpl-mustache">
                <!--<div class="map_container">
                    <img style="max-width:100%;max-height:100%" src="{{property_map}}" class="imgMap" id="map_image" />                
                    <div class="marker" id='scroll_to_marker' data-coords="{{map_x_coordinate}}, {{map_y_coordinate}}">
                        {{name}}
                    </div>   
                </div>-->
                <div class="map-container">
                    <div id="mapsvg_store_detail"></div>
                </div>
                <div class="store_details_container">
                    <div class="row middle_align">
                        <div class="left_promo_div">
                            <img src="{{alt_store_front_url}}" alt="Store Logo" /> 
                        </div>
                        <div class="col-md-5 store_middle">
                            <p class="middle_align store_name">{{name}}</p>
                        </div>
                        <div class="col-md-4 store_middle">
                            <div class="middle_align">
                                <p class="store_website">
                                    <span style="{{show}}"><a target="_blank" href="//{{website}}">website</a> &nbsp; | &nbsp;</span>
                                    <span>{{phone}}
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <div class="store_details_description {{desc_pad}}">{{description}}</div>
                    </div>
                </div>
            </script>
        </div>
        <h2 class="store_list_heading2" id="no_promos">PROMOTIONS & EVENTS</h2>
        <div id="promotions_container">
            <script id="promotions_template" type="x-tmpl-mustache">
                <div class="row">
                   <div class="left_promo_div">
                        <img class="img_auto" src="{{promo_image_url_abs}}" alt="promo" /> 
                    </div>
                    <div class="col-md-9">
                        <p class="promo_name"><a href="/promotions/{{slug}}">{{name}}</a></p>
                        <p class="promo_date">{{dates}}</p>
                        <p class="promo_desc">{{description}}</p>
                        <a href="/promotions/{{slug}}" class="read_more">read more</a>
                    </div>
                </div>
                <hr class="promo_separator" />
            </script>
        </div>
        <h2 class="store_list_heading2" id="no_jobs">CAREERS</h2>
        <div id="jobs_container">
            <script id="jobs_template" type="x-tmpl-mustache">
                <div class="row">
                    <div class="col-md-12">
                        <p class="promo_name"><a href="/promotions/{{slug}}">{{name}}</a></p>
                        <p class="closing_date">Closing date: {{closing_date}}</p>
                        <a data-toggle="collapse" data-parent="#jobs_container" href="#{{slug}}" class="read_more">read more</a>
                        <div id="{{slug}}" class="panel-collapse collapse job_div">
                            <p>{{job_type}}</p>
                            <div>{{{rich_description}}}</div>
                            <br />
                            <div style="{{hide_contact}}">
                                <p class="promo_date">Contact</p>
                                <p>{{contact_name}}</p>
                                <p>{{contact_email}}</p>
                            </div>
                        </div>
                    </div>
                </div>
                <hr class="promo_separator" />
            </script>
        </div>
        <a href="/stores" class="back_btn"><i class="fa fa-chevron-left"></i> &nbsp;BACK</a>
        <br /><br />
    </div>
    <div class="page_right">
        <div class="hours_box feature_box" id="home_hours_container">
            <script id="home_hours_template" type="x-tmpl-mustache/text">
                <h3 class="hours_header">HOURS</h3>
                <p class="check_hours"><a href="/hours">Check Holiday Hours</a></p>
                <h3 class="newsletter_header caps">{{day}} {{month}} {{weekday}}</h3>
                <h3 class="hours_home">{{h}}</h3>
                <p class="call_mp_home"><a href="tel:3066538844">Call 306-653-8844</a></p>
            </script>
        </div>
        <div class="giftcards_box feature_box">
            <a href="/pages/midtown2-gift-cards">
                <h3 class="giftcards_header">GIFT CARDS</h3>
                <img src="//codecloud.cdn.speedyrails.net/sites/599dcb2e6e6f6420d91e0300/image/png/1511216744000/New Gift Card.png" class="" alt="giftcards">
            </a>
        </div>
        
        <div class="newsletter_box feature_box">
            <div id="success_subscribe">
                <i class="fa fa-close pull-right cursor_pointer" id="close_subscribe"></i>
                <p class="middle_align text-center">Thank you for subscribing to our newsletter!</p>
            </div>
            <h3 class="newsletter_header">NEWSLETTER</h3>
            <p>Exclusive deals straight to your inbox!</p>
            <form action="//mobilefringe.createsend.com/t/d/s/yhudtt/" id="newsletter_form">
                <input name="cm-yhudtt-yhudtt" type="text" placeholder="Enter your email address" id="newsletter_email" class="pull-left" required/>
                <input type="submit" value="SUBSCRIBE" class="btn_mp pull-left" />
                <div class="clearfix"></div>
                <label class="check_text"><input type="checkbox" required id="newsletter_agree" />I agree to receive newsletters from Midtown.</label>
            </form>
        </div>
        <div class="feature_box border_1">
            <h3 class="feature_header">Blog</h3>
            <div class="feature_insider" id="home_blog_container">
                <script id="home_blog_template" type="x-tmpl-mustache/text">
                    <div class="feature_insider_right">
                        <h3 class="feature_2_header">{{published_on}}</h3>
                        <p class="feature_2_dates">{{title}}</p>
                        <p class="feature_2_description">{{description_shorter}}</p>
                        <a class="read_more" href="/posts/{{slug}}">read more</a>
                    </div>
                    <div class="feature_insider_left pull-right">
                        <img alt="blog" class="feature_image" src="{{post_image}}" />
                    </div>
                    <div class="clearfix"></div>
                </script>
            </div>
        </div>
    </div>
    <div class="clearfix"></div>
</div>
<script>
    $(document).ready(function(e){
        init(e);
        function renderAll(){
            var pathArray = window.location.pathname.split( '/' );
            var slug = pathArray[pathArray.length-1];
            var store_details = getStoreDetailsBySlug(slug);
            renderStoreDetails("#store_container","#store_template", store_details, slug);
            
            if(store_details.promotions != null){
                renderStoreExtras($('#promotions_container'), $('#promotions_template'), "promos", store_details.promotions);
            } else {
                $('#no_promos').hide();
            }
            
            if(store_details.jobs != null){
                renderStoreExtras($('#jobs_container'), $('#jobs_template'), "jobs", store_details.jobs);
            } else {
                $('#no_jobs').hide();
            }
            
            init_side();
            show_content();
            // var dimension = (store_details.x_coordinate - 460 )  + " " + (store_details.y_coordinate - 230);
            // $(function(){
            //     $('.map_container').craftmap({
            //         image: {
            //             width: 2000,
            //             height: 2000,
            //             name: 'imgMap'
            //         },
            //         map: {
            //             position: dimension
            //         }
            //     });
            //     // $("#anchor_id").click();
            //   	// $("#scroll_to_marker").click();
            // });
            /* MAP */
            regions = {}
            if(store_details.svgmap_region != null && typeof(store_details.svgmap_region)  != 'undefined'){
                obj = {};
                obj["tooltip"] = "<label class='store_name_map store_name_map_detail'> " + store_details.name + " </label>",
                obj["popover"] = "<label class='store_name_map store_name_map_detail'>" + store_details.name + "</label>",
                obj["attr"] = {fill: "#000"},
                regions[store_details.svgmap_region] = obj
            }
            
            var map = $('#mapsvg_main').mapSvg({
                source: getSVGMapURL(),    // Path to SVG map
                colors: {stroke: '#aaaaaa', selected: '#f57b2b', hover: "#f57b2b"},
                disableAll: false,
                regions: regions,
                tooltipsMode: 'custom',
                loadingText: "loading...",
                zoom: true,
                zoomButtons: {'show': true,'location': 'left' },
                pan: true,
                cursor: 'pointer',
                responsive: true,
                zoomLimit: [0, 5],
                // viewBox: store_details.svgmap_region
            });
            map.selectRegion(store_details.svgmap_region);
        }
        loadMallDataCached(renderAll); 
    })
</script>